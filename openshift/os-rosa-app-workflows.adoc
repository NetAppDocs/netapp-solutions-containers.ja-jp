---
sidebar: sidebar 
permalink: openshift/os-rosa-app-workflows.html 
keywords: OpenShift, OCP, Trident, NetApp ONTAP, Red Hat OpenShift Service on AWS, 
summary: NetApp ONTAPを使用した AWS 上の Red Hat OpenShift サービス 
---
= NetApp ONTAPを使用した AWS 上の Red Hat OpenShift サービス
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
このドキュメントでは、 NetApp ONTAP をRed Hat OpenShift Service on AWS (ROSA) で使用する方法について概説します。



== ボリュームスナップショットの作成

**1.アプリ ボリュームのスナップショットを作成する** このセクションでは、アプリに関連付けられたボリュームのトライデント スナップショットを作成する方法を説明します。これは、アプリ データの特定時点のコピーになります。アプリケーション データが失われた場合、この時点のコピーからデータを回復できます。注: このスナップショットは、 ONTAP(オンプレミスまたはクラウド) の元のボリュームと同じアグリゲートに保存されます。したがって、 ONTAPストレージ アグリゲートが失われた場合、そのスナップショットからアプリケーション データを回復することはできません。

**a.  VolumeSnapshotClass を作成し、次のマニフェストを volume-snapshot-class.yaml というファイルに保存します。

[source]
----
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
 name: fsx-snapclass
driver: csi.trident.netapp.io
deletionPolicy: Delete
----
上記のマニフェストを使用してスナップショットを作成します。

image:redhat-openshift-container-rosa-020.png["スナップショットクラス"]

**b.次に、スナップショットを作成します** VolumeSnapshot を作成して、Postgresql データのポイントインタイム コピーを取得し、既存の PVC のスナップショットを作成します。これにより、ファイルシステムのバックエンドでほとんどスペースを占有しない FSx スナップショットが作成されます。次のマニフェストを volume-snapshot.yaml というファイルに保存します。

[source]
----
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshot
metadata:
 name: postgresql-volume-snap-01
spec:
 volumeSnapshotClassName: fsx-snapclass
 source:
   persistentVolumeClaimName: data-postgresql-0
----
**c.ボリュームスナップショットを作成し、作成されたことを確認します**

データベースを削除して、データの損失をシミュレートします (データの損失はさまざまな理由で発生する可能性がありますが、ここではデータベースを削除することでシミュレートしています)

image:redhat-openshift-container-rosa-021.png["ボリュームスナップショット"]

**d.データベースを削除して、データの損失をシミュレートします (データの損失はさまざまな理由で発生する可能性がありますが、ここではデータベースを削除することでシミュレートしています)**

image:redhat-openshift-container-rosa-022.png["データベース接続"]

image:redhat-openshift-container-rosa-023.png["データベースを削除"]



== ボリュームスナップショットからの復元

**1.スナップショットからの復元** このセクションでは、アプリ ボリュームの Trident スナップショットからアプリケーションを復元する方法を説明します。

**a.スナップショットからボリュームのクローンを作成する**

ボリュームを以前の状態に復元するには、取得したスナップショットのデータに基づいて新しい PVC を作成する必要があります。これを行うには、次のマニフェストをpvc-clone.yamlというファイルに保存します。

[source]
----
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
 name: postgresql-volume-clone
spec:
 accessModes:
   - ReadWriteOnce
 storageClassName: trident-csi
 resources:
   requests:
     storage: 8Gi
 dataSource:
   name: postgresql-volume-snap-01
   kind: VolumeSnapshot
   apiGroup: snapshot.storage.k8s.io
----
上記のマニフェストを使用して、スナップショットをソースとして PVC を作成し、ボリュームのクローンを作成します。マニフェストを適用し、クローンが作成されたことを確認します。

image:redhat-openshift-container-rosa-024.png["スナップショットからのPostgreSQLクローン"]

**b.元の postgresql インストールを削除します**

image:redhat-openshift-container-rosa-025.png["PostgreSQLアプリの削除"]

**c.新しいクローン PVC を使用して新しい postgresql アプリケーションを作成します**

[source]
----
$ helm install postgresql bitnami/postgresql --set primary.persistence.enabled=true --set primary.persistence.existingClaim=postgresql-volume-clone -n postgresql
----
image:redhat-openshift-container-rosa-026.png["postgresqlの新規インストール"]

**d.アプリケーションポッドが実行状態であることを確認します**

image:redhat-openshift-container-rosa-027.png["postgresqlの新規インストール"]

**e.ポッドがクローンを PVC として使用していることを確認します**

image:redhat-openshift-container-rosa-028.png["postgresql 新規インストール 記述"]

image:redhat-openshift-container-rosa-029.png["新しいPVCはクローンです"]

f) データベースが期待通りに復元されたことを確認するには、コンテナコンソールに戻り、既存のデータベースを表示します。

image:redhat-openshift-container-rosa-030.png["データベースが復元されました"]



== デモビデオ

.ホスト型コントロールプレーンを使用した AWS 上の Red Hat OpenShift サービスとAmazon FSx for NetApp ONTAP
video::213061d2-53e6-4762-a68f-b21401519023[panopto,width=360]
Red Hat OpenShiftとOpenShiftソリューションに関するその他のビデオは以下をご覧ください。link:../videos/openshift-videos.html["ここをクリックしてください。"] 。
