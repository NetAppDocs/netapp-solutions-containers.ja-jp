---
sidebar: sidebar 
permalink: openshift/os-on-vmw.html 
keywords: OpenShift, VMware vSphere, ESXi 
summary: VMware vSphere は、ESXi ハイパーバイザー上で実行される多数の仮想化サーバーとネットワークを集中管理するための仮想化プラットフォームです。 
---
= VMware vSphere 上の OpenShift
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
VMware vSphere は、ESXi ハイパーバイザー上で実行される多数の仮想化サーバーとネットワークを集中管理するための仮想化プラットフォームです。

VMware vSphereの詳細については、link:https://www.vmware.com/products/vsphere.html["VMware vSphere Web サイト"^] 。

VMware vSphere は次の機能を提供します。

* *VMware vCenter Server* VMware vCenter Server は、単一のコンソールからすべてのホストと VM を統合管理し、クラスター、ホスト、および VM のパフォーマンス監視を集約します。
* *VMware vSphere vMotion* VMware vCenter を使用すると、リクエストに応じて、中断することなくクラスター内のノード間で VM をホット マイグレーションできます。
* *vSphere High Availability* ホスト障害が発生した場合の中断を回避するために、VMware vSphere では、ホストをクラスタ化し、高可用性用に構成できます。ホスト障害によって中断された VM は、クラスター内の他のホスト上ですぐに再起動され、サービスが復元されます。
* *分散リソース スケジューラ (DRS)* VMware vSphere クラスターは、ホストしている VM のリソース ニーズを負荷分散するように構成できます。リソース競合が発生している VM は、十分なリソースが利用可能であることを保証するため、クラスター内の他のノードにホット移行できます。


image:redhat-openshift-033.png["入出力ダイアログまたは書かれたコンテンツを示す図"]



== ネットワーク設計

Red Hat OpenShift on NetAppソリューションは、2 つのデータ スイッチを使用して 25 Gbps でプライマリ データ接続を提供します。また、ストレージ ノードのインバンド管理と IPMI 機能のアウトオブバンド管理のために 1 Gbps の接続を提供する 2 つの追加管理スイッチも使用します。 OCP は、クラスター管理に VMware vSphere 上の VM 論理ネットワークを使用します。このセクションでは、ソリューションで使用される各仮想ネットワーク セグメントの配置と目的について説明し、ソリューションの展開の前提条件の概要を示します。



=== VLANの要件

VMware vSphere 上の Red Hat OpenShift は、仮想ローカル エリア ネットワーク (VLAN) を使用して、さまざまな目的に合わせてネットワーク トラフィックを論理的に分離するように設計されています。この構成は、顧客の要求を満たすために、または特定のネットワーク サービスをさらに分離するために拡張できます。次の表は、 NetAppでソリューションを検証する際にソリューションを実装するために必要な VLAN を示しています。

[cols="40%, 40%, 20%"]
|===
| VLAN | 目的 | VLAN ID 


| 帯域外管理ネットワーク | 物理ノードとIPMIの管理 | 16 


| VMネットワーク | 仮想ゲストネットワークアクセス | 181 


| ストレージ ネットワーク | ONTAP NFSのストレージネットワーク | 184 


| ストレージ ネットワーク | ONTAP iSCSI のストレージ ネットワーク | 185 


| インバンド管理ネットワーク | ESXiノード、VCenter Server、 ONTAP Selectの管理 | 3480 


| ストレージ ネットワーク | NetApp Element iSCSI のストレージ ネットワーク | 3481 


| 移住ネットワーク | 仮想ゲスト移行用のネットワーク | 3482 
|===


=== ネットワークインフラストラクチャサポートリソース

OpenShift Container Platform をデプロイする前に、次のインフラストラクチャを準備しておく必要があります。

* インバンド管理ネットワークおよび VM ネットワークからアクセス可能な完全なホスト名解決を提供する少なくとも 1 つの DNS サーバー。
* インバンド管理ネットワークと VM ネットワークからアクセス可能な NTP サーバーが少なくとも 1 つ。
* (オプション) インバンド管理ネットワークと VM ネットワークの両方に対する送信インターネット接続。




== 本番環境への導入に関するベストプラクティス

このセクションでは、このソリューションを本番環境に導入する前に組織が考慮する必要があるベスト プラクティスをいくつか示します。



=== 少なくとも3つのノードのESXiクラスタにOpenShiftをデプロイする

このドキュメントで説明する検証済みのアーキテクチャは、2 つの ESXi ハイパーバイザー ノードを展開し、VMware vSphere HA と VMware vMotion を有効にしてフォールト トレラント構成を確保することで、HA 操作に適した最小限のハードウェア展開を示します。この構成により、展開された VM を 2 つのハイパーバイザー間で移行し、1 つのホストが使用できなくなった場合に再起動することができます。

Red Hat OpenShift は最初に 3 つのマスターノードでデプロイされるため、状況によっては 2 ノード構成内の少なくとも 2 つのマスターが同じノードを占有することがあり、その特定のノードが使用できなくなった場合に OpenShift が停止する可能性があります。したがって、OpenShift マスターを均等に分散してフォールト トレランスをさらに高めるためには、少なくとも 3 つの ESXi ハイパーバイザー ノードをデプロイすることが Red Hat のベスト プラクティスです。



=== 仮想マシンとホストのアフィニティを構成する

VM とホストのアフィニティを有効にすることで、OpenShift マスターを複数のハイパーバイザー ノードに分散させることができます。

アフィニティまたはアンチアフィニティは、VM がグループ内の同じホストまたは複数のホスト上で一緒に実行されるか、または異なるホスト上で実行されるかを決定する VM および/またはホストのセットのルールを定義する方法です。これは、一連の同一のパラメータと条件を持つ VM やホストで構成されるアフィニティ グループを作成することによって VM に適用されます。アフィニティ グループ内の VM が同じホスト上で実行されるか、グループ内のホスト上で実行されるか、または異なるホスト上で個別に実行されるかに応じて、アフィニティ グループのパラメータは、正のアフィニティまたは負のアフィニティのいずれかを定義できます。

アフィニティグループを構成するには、link:https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.resmgmt.doc/GUID-FF28F29C-8B67-4EFF-A2EF-63B3537E6934.html["vSphere 6.7 ドキュメント: DRS アフィニティ ルールの使用"^] 。



=== OpenShift のデプロイメントにカスタム インストール ファイルを使用する

IPI は、このドキュメントで前述した対話型ウィザードを通じて OpenShift クラスターのデプロイメントを容易にします。ただし、クラスターの展開の一環として、いくつかのデフォルト値を変更する必要がある場合があります。

このような場合、クラスターをすぐに展開せずにウィザードを実行してタスクを実行できますが、代わりにウィザードによって、後でクラスターを展開できる構成ファイルが作成されます。これは、IPI のデフォルトを変更する必要がある場合、またはマルチテナントなどの他の用途のために環境内に複数の同一クラスターを展開する場合に非常に便利です。  OpenShiftのカスタマイズされたインストール構成の作成の詳細については、以下を参照してください。link:https://docs.openshift.com/container-platform/4.7/installing/installing_vsphere/installing-vsphere-installer-provisioned-customizations.html["Red Hat OpenShift カスタマイズによる vSphere へのクラスタのインストール"^] 。
