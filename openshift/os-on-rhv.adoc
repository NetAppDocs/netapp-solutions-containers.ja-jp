---
sidebar: sidebar 
permalink: openshift/os-on-rhv.html 
keywords: Red Hat Virtualization, OpenShift, RHV 
summary: 'RHV は、Red Hat Enterprise Linux (RHEL) 上で実行され、KVM ハイパーバイザーを使用するエンタープライズ仮想データセンター プラットフォームです。' 
---
= Red Hat Virtualization 上の OpenShift
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Red Hat Virtualization (RHV) は、Red Hat Enterprise Linux (RHEL) 上で実行され、KVM ハイパーバイザーを使用するエンタープライズ仮想データセンター プラットフォームです。

RHVの詳細については、link:https://www.redhat.com/en/technologies/virtualization/enterprise-virtualization["Red Hat Virtualization のウェブサイト"^] 。

RHV は次の機能を提供します。

* *VM とホストの集中管理* RHV マネージャーは、展開内で物理マシンまたは仮想マシン (VM) として実行され、中央インターフェースからソリューションを管理するための Web ベースの GUI を提供します。
* *セルフホストエンジン* ハードウェア要件を最小限に抑えるために、RHV では、ゲスト VM を実行する同じホスト上に RHV Manager (RHV-M) を VM として展開できます。
* *高可用性* ホスト障害が発生した場合の中断を回避するために、RHV では VM を高可用性向けに構成できます。高可用性 VM は、回復性ポリシーを使用してクラスター レベルで制御されます。
* *高いスケーラビリティ* 単一の RHV クラスターには最大 200 個のハイパーバイザー ホストを含めることができるため、大量のリソースを必要とするエンタープライズ クラスのワークロードをホストする大規模な VM の要件をサポートできます。
* *強化されたセキュリティ* RHV から継承された Secure Virtualization (sVirt) および Security Enhanced Linux (SELinux) テクノロジは、ホストと VM のセキュリティと強化を強化するために RHV によって採用されています。これらの機能の主な利点は、VM とその関連リソースの論理的な分離です。


image:redhat-openshift-003.png["入出力ダイアログまたは書かれたコンテンツを示す図"]



== ネットワーク設計

Red Hat OpenShift on NetAppソリューションは、2 つのデータ スイッチを使用して 25 Gbps でプライマリ データ接続を提供します。また、ストレージ ノードのインバンド管理と IPMI 機能のアウトオブバンド管理のために 1 Gbps の接続を提供する 2 つの追加管理スイッチも使用します。 OCP は、クラスター管理に RHV 上の仮想マシン論理ネットワークを使用します。このセクションでは、ソリューションで使用される各仮想ネットワーク セグメントの配置と目的について説明し、ソリューションを展開するための前提条件の概要を示します。



=== VLANの要件

RHV 上の Red Hat OpenShift は、仮想ローカル エリア ネットワーク (VLAN) を使用して、さまざまな目的に合わせてネットワーク トラフィックを論理的に分離するように設計されています。この構成は、顧客の要求を満たすために、または特定のネットワーク サービスをさらに分離するために拡張できます。次の表は、 NetAppでソリューションを検証する際にソリューションを実装するために必要な VLAN を示しています。

[cols="40%, 40%, 20%"]
|===
| VLAN | 目的 | VLAN ID 


| 帯域外管理ネットワーク | 物理ノードとIPMIの管理 | 16 


| VMネットワーク | 仮想ゲストネットワークアクセス | 1172 


| インバンド管理ネットワーク | RHV-Hノード、RHV-Manager、およびovirtmgmtネットワークの管理 | 3343 


| ストレージ ネットワーク | NetApp Element iSCSI のストレージ ネットワーク | 3344 


| 移住ネットワーク | 仮想ゲスト移行用のネットワーク | 3345 
|===


=== ネットワークインフラストラクチャサポートリソース

OpenShift Container Platform をデプロイする前に、次のインフラストラクチャを準備しておく必要があります。

* インバンド管理ネットワークおよび VM ネットワークからアクセス可能な完全なホスト名解決を提供する少なくとも 1 つの DNS サーバー。
* インバンド管理ネットワークと VM ネットワークからアクセス可能な NTP サーバーが少なくとも 1 つ。
* (オプション) インバンド管理ネットワークと VM ネットワークの両方に対する送信インターネット接続。




== 本番環境への導入に関するベストプラクティス

このセクションでは、このソリューションを本番環境に導入する前に組織が考慮する必要があるベスト プラクティスをいくつか示します。



=== 少なくとも3ノードのRHVクラスタにOpenShiftをデプロイする

このドキュメントで説明する検証済みのアーキテクチャは、2 つの RHV-H ハイパーバイザー ノードを展開し、両方のホストがホスト エンジンを管理でき、展開された VM が 2 つのハイパーバイザー間で移行できるフォールト トレラント構成を確保することで、HA 操作に適した最小限のハードウェア展開を示します。

Red Hat OpenShift は最初に 3 つのマスターノードでデプロイされるため、2 ノード構成では少なくとも 2 つのマスターが同じノードを占有することが保証され、その特定のノードが使用できなくなった場合に OpenShift が停止する可能性があります。したがって、OpenShift マスターを均等に分散し、ソリューションのフォールト トレランスをさらに高めるために、ソリューションの一部として少なくとも 3 つの RHV-H ハイパーバイザー ノードを展開することが Red Hat のベスト プラクティスです。



=== 仮想マシン/ホストアフィニティを構成する

VM/ホスト アフィニティを有効にすると、OpenShift マスターを複数のハイパーバイザー ノードに分散できます。

アフィニティは、VM がグループ内の同じホストまたは複数のホスト上で一緒に実行されるか、または異なるホスト上で実行されるかを決定する VM および/またはホストのセットのルールを定義する方法です。これは、一連の同一のパラメータと条件を持つ VM やホストで構成されるアフィニティ グループを作成することによって VM に適用されます。アフィニティ グループ内の VM が同じホスト上で実行されるか、グループ内のホスト上で実行されるか、または異なるホスト上で個別に実行されるかに応じて、アフィニティ グループのパラメータは、正のアフィニティまたは負のアフィニティのいずれかを定義できます。

パラメータに定義される条件は、ハード強制またはソフト強制のいずれかになります。ハード強制により、アフィニティ グループ内の VM は、外部条件に関係なく、常に正または負のアフィニティに厳密に従うようになります。ソフト強制により、アフィニティ グループ内の VM が可能な限り正または負のアフィニティに従うように高い優先順位が設定されます。このドキュメントで説明されている 2 つまたは 3 つのハイパーバイザー構成では、ソフト アフィニティが推奨される設定です。大規模なクラスターでは、ハード アフィニティによって OpenShift ノードを正しく分散できます。

アフィニティグループを構成するには、link:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html/virtual_machine_management_guide/sect-affinity_groups["レッドハット6.11。アフィニティグループのドキュメント"^] 。



=== OpenShift のデプロイメントにカスタム インストール ファイルを使用する

IPI は、このドキュメントで前述した対話型ウィザードを通じて OpenShift クラスターのデプロイメントを容易にします。ただし、クラスターの展開の一環として、いくつかのデフォルト値を変更する必要がある可能性があります。

このような場合、クラスターをすぐに展開せずにウィザードを実行してタスクを実行できます。代わりに、後でクラスターをデプロイできる構成ファイルが作成されます。これは、IPI のデフォルトを変更する場合や、マルチテナントなどの他の用途のために環境内に複数の同一クラスターを展開する場合に非常に便利です。  OpenShiftのカスタマイズされたインストール構成の作成の詳細については、以下を参照してください。link:https://docs.openshift.com/container-platform/4.4/installing/installing_rhv/installing-rhv-customizations.html["Red Hat OpenShift カスタマイズによるRHVへのクラスターのインストール"^] 。
