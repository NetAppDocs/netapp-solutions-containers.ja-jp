---
sidebar: sidebar 
permalink: tanzu/vtwn-trident-ontap-iscsi.html 
keywords: Trident, Trident, ONTAP, AFF, FAS, iSCSI, Tanzu, TKG, TKGS, TKGI 
summary: iSCSI 経由で永続ボリューム用のNetApp ONTAPストレージ システムを VMware Tanzu Kubernetes クラスターと統合するには、まず各ノードにログインし、iSCSI ボリュームをマウントするための iSCSI ユーティリティまたはパッケージを構成してノードを準備する必要があります。 
---
= NetApp ONTAP iSCSI構成
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
iSCSI 経由で永続ボリューム用のNetApp ONTAPストレージ システムを VMware Tanzu Kubernetes クラスターと統合するには、まず各ノードにログインし、iSCSI ボリュームをマウントするための iSCSI ユーティリティまたはパッケージを構成してノードを準備する必要があります。そのためには、ここに記載されている手順に従ってください。link:https://docs.netapp.com/us-en/trident/trident-use/worker-node-prep.html#iscsi-volumes["リンク"^] 。


NOTE: NetApp、VMware Tanzu Kubernetes クラスタの NAT 展開にはこの手順を推奨していません。


NOTE: TKGI は、不変の構成イメージを実行する Tanzu Kubernetes クラスターのノードとして Bosh VM を使用します。Bosh VM 上の iSCSI パッケージの手動変更は、再起動後も保持されません。したがって、 NetApp は、TKGI によって導入および運用される Tanzu Kubernetes クラスターの永続ストレージには NFS ボリュームを使用することを推奨しています。

iSCSI ボリューム用にクラスター ノードを準備したら、ストレージ システムとの通信を可能にするバックエンドを作成する必要があります。このソリューションでは基本的なバックエンドを構成しましたが、よりカスタマイズされたオプションを探している場合は、ドキュメントを参照してください。link:https://docs.netapp.com/us-en/trident/trident-use/ontap-san.html["ここをクリックしてください。"^] 。



== ONTAPでSVMを作成する

ONTAPで SVM を作成するには、次の手順を実行します。

. ONTAP System Manager にログインし、[ストレージ] > [ストレージ VM] に移動して、[追加] をクリックします。
. SVM の名前を入力し、iSCSI プロトコルを有効にして、データ LIF の詳細を入力します。
+
image:vtwn-025.png["iSCSI SVM データ LIF"]

. SVM 管理アカウントの詳細を入力し、「保存」をクリックします。
+
image:vtwn-026.png["iSCSI SVM管理"]

. アグリゲートを SVM に割り当てるには、[ストレージ] > [ストレージ VM] に移動し、新しく作成した SVM の横にある省略記号をクリックして、[編集] をクリックします。  「ボリュームの作成を優先ローカル階層に制限する」チェックボックスをオンにして、必要なアグリゲートを接続します。
+
image:vtwn-027.png["SVM集約割り当て"]





== バックエンドとストレージクラスを作成する

. NFS を提供するNetApp ONTAPシステムの場合、backendName、managementLIF、dataLIF、svm、ユーザー名、パスワードなどの詳細を含むバックエンド構成ファイルをジャンプホストに作成します。
+
[listing]
----
{
  "version": 1,
  "storageDriverName": "ontap-san",
  "backendName": "ontap-san+10.61.181.231",
  "managementLIF": "172.21.224.201",
  "dataLIF": "10.61.181.231",
  "svm": "trident_svm_iscsi",
  "username": "admin",
  "password": "password"
}
----
. 次のコマンドを実行して、 Tridentバックエンドを作成します。
+
[listing]
----
[netapp-user@rhel7 trident-installer]$ ./tridentctl -n trident create backend -f backend-ontap-san.json
+------------------------+----------------+--------------------------------------+--------+---------+
|          NAME          | STORAGE DRIVER |                 UUID                 | STATE  | VOLUMES |
+------------------------+----------------+--------------------------------------+--------+---------+
| ontap-san+10.61.181.231 | ontap-san      | 6788533c-7fea-4a35-b797-fb9bb3322b91 | online |       0 |
+------------------------+----------------+--------------------------------------+--------+---------+
----
. バックエンドを作成したら、次にストレージ クラスを作成する必要があります。次のサンプル ストレージ クラス定義では、必須フィールドと基本フィールドが強調表示されています。パラメータ `backendType`新しく作成されたTridentバックエンドのストレージ ドライバーを反映する必要があります。また、後の手順で参照する必要がある名前フィールドの値にも注意してください。
+
[listing]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: ontap-iscsi
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-san"
----
+

NOTE: オプションフィールドがあります `fsType`このファイルで定義されます。  iSCSI バックエンドでは、この値を特定の Linux ファイルシステム タイプ (XFS、ext4 など) に設定するか、削除して Tanzu Kubernetes クラスターが使用するファイルシステムを決定できるようにすることができます。

. kubectl コマンドを実行してストレージ クラスを作成します。
+
[listing]
----
[netapp-user@rhel7 trident-installer]$ kubectl create -f storage-class-iscsi.yaml
storageclass.storage.k8s.io/ontap-iscsi created
----
. ストレージ クラスを作成したら、最初の永続ボリューム要求 (PVC) を作成する必要があります。 PVC 定義のサンプルを以下に示します。必ず `storageClassName`フィールドは、作成したストレージ クラスの名前と一致します。  PVC 定義は、プロビジョニングするワークロードに応じて必要に応じてさらにカスタマイズできます。
+
[listing]
----
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: basic
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
  storageClassName: ontap-iscsi
----
. kubectl コマンドを発行して PVC を作成します。作成するバックアップボリュームのサイズによっては、作成に時間がかかる場合があります。そのため、プロセスが完了するまで監視することができます。
+
[listing]
----
[netapp-user@rhel7 trident-installer]$ kubectl create -f pvc-basic.yaml
persistentvolumeclaim/basic created

[netapp-user@rhel7 trident-installer]$ kubectl get pvc
NAME    STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
basic   Bound    pvc-7ceac1ba-0189-43c7-8f98-094719f7956c   1Gi        RWO            ontap-iscsi      3s
----

