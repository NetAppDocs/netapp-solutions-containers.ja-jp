---
sidebar: sidebar 
permalink: anthos/anthos-vmw.html 
keywords: Anthos, VMware vSphere, ESXi, on_prem 
summary: VMware vSphere は、ESXi ハイパーバイザー上で実行される多数の仮想化サーバーとネットワークを集中管理するための仮想化プラットフォームです。 
---
= VMware 上の Anthos クラスタ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Anthos clusters on VMware は、エンドユーザーのプライベート データセンターにデプロイされる Google Kubernetes Engine の拡張機能です。組織は、Google Cloud のコンテナで実行するように設計された同じアプリケーションを、オンプレミスの Kubernetes クラスタにデプロイできます。  Anthos clusters on VMware は、データセンター内の既存の VMware vSphere 環境にデプロイできるため、設備投資を節約し、より迅速なデプロイとスケーリング操作が可能になります。

VMware 上の Anthos クラスタのデプロイメントには、次のコンポーネントが含まれます。

* *Anthos 管理ワークステーション*デプロイメントホストから `gkectl`そして `kubectl`コマンドを実行して Anthos デプロイメントをデプロイおよび操作できます。
* *管理クラスター。* VMware 上に Anthos クラスタをセットアップするときにデプロイされる初期クラスタ。このクラスターは、デプロイ、スケーリング、アップグレードなど、すべての従属ユーザー クラスター アクションを管理します。
* *ユーザー クラスター。*各ユーザー クラスターは、独自のロード バランサ インスタンスまたはパーティションを使用してデプロイされるため、個々のユーザーまたはグループに対してスタンドアロンの Kubernetes クラスターとして機能することができ、完全なマルチテナンシーを実現できます。


次の図は、Anthos-clusters-on-VMware のデプロイメントの説明です。

image:a-w-n-anthos-controlplanev2-vm-architecture.png["入出力ダイアログまたは書かれたコンテンツを示す図"]



== 利点

Anthos clusters on VMware には、次のような利点があります。

* *高度なマルチテナント*各エンドユーザーには独自のユーザー クラスターを割り当てることができ、独自の開発環境に必要な仮想リソースがデプロイされます。
* *コスト削減*エンドユーザーは、Google Cloud 環境または大規模なベアメタル クラスタでリソースをプロビジョニングする代わりに、複数のユーザー クラスタを同じ物理環境にデプロイし、アプリケーションのデプロイに独自の物理リソースを利用することで、大幅なコスト削減を実現できます。
* *開発してから公開します。*アプリケーションの開発中にオンプレミス展開を使用できるため、クラウドで一般公開する前に、ローカル データ センターのプライバシー内でアプリケーションをテストできます。
* *セキュリティ要件*セキュリティ上の懸念が高まっているお客様や、パブリック クラウドに保存できない機密データ セットを抱えるお客様は、自社のデータ センターのセキュリティからアプリケーションを実行できるため、組織の要件を満たすことができます。




== VMware vSphere

VMware vSphere は、ESXi ハイパーバイザー上で実行される多数の仮想化サーバーとネットワークを集中管理するための仮想化プラットフォームです。

VMware vSphereの詳細については、 https://www.vmware.com/products/vsphere.html["VMware vSphere Web サイト"^] 。

VMware vSphere は次の機能を提供します。

* *VMware vCenter サーバー。*  VMware vCenter Server は、単一のコンソールからすべてのホストと VM を統合管理し、クラスタ、ホスト、VM のパフォーマンス監視を集約します。
* *VMware vSphere vMotion。*  VMware vCenter を使用すると、リクエストに応じて、中断することなくクラスター内のノード間で VM をホット マイグレーションできます。
* *vSphere 高可用性。*ホスト障害が発生した場合の中断を回避するために、VMware vSphere では、ホストをクラスタ化し、高可用性を実現するように構成できます。ホスト障害によって中断された VM は、クラスター内の他のホスト上ですぐに再起動され、サービスが復元されます。
* *分散リソース スケジューラ (DRS)* VMware vSphere クラスターは、ホストしている VM のリソースニーズを負荷分散するように構成できます。リソース競合が発生している VM は、十分なリソースが利用可能であることを保証するため、クラスター内の他のノードにホット移行できます。




== ハードウェア要件



=== コンピューティング

Google Cloud は、Anthos Ready プラットフォーム パートナー プログラムを通じて、Anthos の新しいリリースを使用したパートナー サーバー プラットフォームの更新された検証を定期的に要求します。現在検証済みのサーバープラットフォームとサポートされているAnthosのバージョンの一覧は、 https://cloud.google.com/anthos/docs/resources/partner-platforms["ここをクリックしてください。"^] 。



=== オペレーティング システム

VMware 上の Anthos クラスタは、顧客の現在のデータセンター インフラストラクチャに合わせて、顧客の選択に応じて vSphere 7 と 8 の両方の環境にデプロイできます。

次の表には、 NetAppとパートナーがソリューションを検証するために使用した vSphere バージョンの一覧が含まれています。

|===


| オペレーティング システム | リリース | Anthos バージョン 


| VCenter | 8.0.1 | 1.28 
|===


=== 追加のハードウェア

NetAppを使用した Anthos の導入を完全に検証済みのソリューションとして完了するために、ネットワークとストレージ用の追加データセンター コンポーネントがNetAppとパートナー エンジニアによってテストされました。

次の表には、これらの追加のインフラストラクチャ コンポーネントに関する情報が含まれています。

|===
| メーカー | ハードウェアコンポーネント 


| Mellanox | スイッチ（データネットワーク） 


| Cisco | スイッチ（管理ネットワーク） 


| NetApp | AFFストレージシステム 
|===


=== 追加ソフトウェア

次の表には、検証環境に展開されているソフトウェア バージョンの一覧が含まれています。

|===


| メーカー | ソフトウェア名 | version 


| NetApp | ONTAP | 9.12.1 


| NetApp | Trident | 24.02.0 
|===
NetAppが実施した Anthos Ready プラットフォーム検証では、次の図に基づいてラボ環境が構築され、さまざまなNetApp ONTAPストレージ バックエンドを使用して複数のシナリオをテストすることができました。

image:a-w-n-anthos-128-vsphere8-validation.png["入出力ダイアログまたは書かれたコンテンツを示す図"]



=== ネットワークインフラストラクチャサポートリソース

Anthos をデプロイする前に、次のインフラストラクチャを準備しておく必要があります。

* インバンド管理ネットワークおよび VM ネットワークからアクセス可能な完全なホスト名解決を提供する少なくとも 1 つの DNS サーバー。
* インバンド管理ネットワークと VM ネットワークからアクセス可能な NTP サーバーが少なくとも 1 つ。
* クラスターを動的に拡張する必要がある場合に、オンデマンドでネットワーク アドレスのリースを提供できる DHCP サーバー。
* (オプション) インバンド管理ネットワークと VM ネットワークの両方に対する送信インターネット接続。




== 本番環境への導入に関するベストプラクティス

このセクションでは、このソリューションを本番環境に導入する前に組織が考慮する必要があるベスト プラクティスをいくつか示します。



=== 少なくとも 3 つのノードの ESXi クラスタに Anthos をデプロイする

デモや評価の目的で 3 ノード未満の vSphere クラスタに Anthos をインストールすることは可能ですが、本番環境のワークロードには推奨されません。  2 つのノードでは基本的な HA とフォールト トレランスが可能になりますが、デフォルトのホスト アフィニティを無効にするには Anthos クラスタ構成を変更する必要があり、このデプロイメント方法は Google Cloud ではサポートされていません。



=== 仮想マシンとホストのアフィニティを構成する

VM とホスト アフィニティを有効にすると、Anthos クラスタ ノードを複数のハイパーバイザー ノードに分散できます。

アフィニティまたはアンチアフィニティは、VM がグループ内の同じホストまたは複数のホスト上で一緒に実行されるか、または異なるホスト上で実行されるかを決定する VM および/またはホストのセットのルールを定義する方法です。これは、一連の同一のパラメータと条件を持つ VM やホストで構成されるアフィニティ グループを作成することによって VM に適用されます。アフィニティ グループ内の VM が同じホスト上で実行されるか、グループ内のホスト上で実行されるか、または異なるホスト上で個別に実行されるかに応じて、アフィニティ グループのパラメータは、正のアフィニティまたは負のアフィニティのいずれかを定義できます。

アフィニティ グループを構成するには、VMWare vSphere のバージョンに応じて以下の適切なリンクを参照してください。

https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.resmgmt.doc/GUID-FF28F29C-8B67-4EFF-A2EF-63B3537E6934.html["vSphere 6.7 ドキュメント: DRS アフィニティ ルールの使用"^] 。https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.resmgmt.doc/GUID-FF28F29C-8B67-4EFF-A2EF-63B3537E6934.html["vSphere 7.0 ドキュメント: DRS アフィニティ ルールの使用"^] 。


NOTE: Anthosには、個々の `cluster.yaml`ファイルを使用すると、環境内の ESXi ホストの数に基づいて有効化または無効化できるノード アフィニティ ルールが自動的に作成されます。
